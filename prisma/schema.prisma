// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// 상품 정보
model Prize {
  id                String   @id @default(cuid())
  name              String  // 예: "스타벅스 아메리카노"
  stock             Int     // 재고 수량
  probability       Float   // 당첨 확률 (0.0 ~ 1.0)
  giftshowGoodsCode String  // 기프트쇼 API 연동을 위한 상품 코드
  imageUrl          String // 상품 이미지 URL
  winners           Winner[]
}

// 관리자가 발급하는 참여 코드
model ParticipationCode {
  id        String   @id @default(cuid())
  code      String   @unique // 예: "A1B2-C3D4-E5F6"
  isUsed    Boolean  @default(false)
  createdAt DateTime @default(now())
  usedAt    DateTime?
  winner    Winner?
}

// 당첨자 정보
model Winner {
  id                  String            @id @default(cuid())
  userPhoneNumber     String            // 쿠폰을 수신할 휴대폰 번호 (참여 시점에는 없음)
  sentAt              DateTime          @default(now())
  giftshowTrId        String            // 기프트쇼 API 발송 후 받은 거래 ID (수령 시점에 생성)

  prize               Prize             @relation(fields: [prizeId], references: [id])
  prizeId             String

  participationCode   ParticipationCode @relation(fields: [participationCodeId], references: [id])
  participationCodeId String            @unique
}
